**从设计到装配再到软件联调**

# 0. 目标与约束

* 形态：直径 70–100 mm 的透明“水晶球”（优选光学级亚克力/玻璃实心球），底部内嵌一块**圆形显示屏**，人物画面经球体折射呈现为“悬浮”。
* 交互：按键/轻触唤醒 → 语音输入 → LLM 生成回复 → TTS 播放，同时口型/表情同步。
* 电源：Type-C 供电或内置锂电（手持演示 5–15 分钟）。
* 环境：室内普通光线；强光下需遮光罩。

---

# 1. 工业设计与光学设计

## 1.1 水晶球与尺寸匹配

* **材质**：

  * PMMA（亚克力）球，折射率 n≈1.49，重量轻、抗摔、易加工；
  * K9 玻璃球 n≈1.52，通透度更好但更重。
* **直径建议**：

  * 搭配 **2.1" 圆形屏（≈53 mm 可视区）** → 球径 80–90 mm；
  * 搭配 **1.28" 圆形屏（≈32–34 mm 可视区）** → 球径 60–70 mm。
* **观感原则**：球的可视角度主要取决于“屏幕有效图像的中心 60% 区域”；越靠近球心、越居中，畸变越小、清晰度越高。

## 1.2 屏-球相对位置

* **屏幕中心对准球心**：屏幕面与球体**紧贴或留 0.5–1 mm 气隙**；
* **耦合处理**（进阶）：可在屏与球之间点涂**光学硅胶/耦合胶**（减少反射高光、提升通透），但会增加拆装难度，MVP 可先留气隙。
* **遮光与黑腔**：在屏周围做 **黑色消光“碗形罩”**（3D 打印/植绒纸内衬），只让屏幕发出的光进入球体，显著提升对比度。

## 1.3 结构件

* **底座**：环形卡槽 + 三点弹性支撑，保证球体可拆且不滑动；
* **导热**：在屏背/主板与底座之间加导热垫，把热量传至金属底圈；
* **按键/触摸**：底圈放 1 个唤醒键或电容触摸片；
* **接口**：Type-C 露出于底圈背面，便于桌面/手持切换。

---

# 2. 电子与选型

## 2.1 显示屏方案（二选一，推荐 A）

* **A. 2.1" 圆形 IPS 480×480 + HDMI 驱动板**（推荐）

  * 优点：直接接 HDMI，播放视频/Unity 渲染都轻松；亮度较高。
  * 供电：5 V；接口：HDMI、USB/排线供电。
* **B. 1.28"/1.3" 圆形 SPI TFT（GC9A01 / ST7789 240×240）**

  * 优点：更便宜更小；
  * 缺点：SPI 帧率低（动画受限），不适合流畅口型。

## 2.2 主控（二选一）

* **Raspberry Pi Zero 2 W / Pi 4（推荐）**

  * 负责：LLM 调用（云端）、音频采集播放、画面渲染、口型同步；
  * 接口充足，生态成熟。
* **Android 手机 + HDMI 输出/投屏（备选）**

  * 手机做 ASR/LLM/TTS，外接 HDMI-to-Type-C 扩展坞输出到圆屏驱动板；
  * 省开发，但线材多、结构拥挤。

## 2.3 音频链路

* **麦克风**：USB 小麦或 I2S 模块（带降噪阵列更佳）；
* **扬声器**：8 Ω 1–2 W 迷你喇叭 + I2S D 类功放（MAX98357A）；
* **回声处理**：软件回声抑制（SpeexDSP/WebRTC AEC）。

## 2.4 供电

* **桌面演示**：5 V/3 A Type-C 适配器；
* **手持**：1S 锂电（2000–3000 mAh）+ 升压到 5 V 模块 + 保护/充电板（TP4056），并加物理总开关。

---

# 3. 软件系统与核心技术

## 3.1 系统栈（以 Raspberry Pi 为例）

* OS：Raspberry Pi OS Lite；
* 图形：**pygame/SDL** 或 **Unity（Pi 4 更合适）** 渲染 480×480 全屏圆形画面；
* 自启动：systemd 服务开机自启；
* 日志与远程：journalctl + SSH，异常远程维护。

## 3.2 语音交互链路（云端优先，轻量稳定）

1. **唤醒**：

   * 方案简化：按键/触摸触发录音；
   * 进阶：本地离线唤醒词（Porcupine/WeWake）。
2. **ASR（语音转文字）**：

   * 云端：Azure/讯飞/Google STT（延迟低，准确率高）；
   * 本地可选：**Whisper small/int8**（Pi 4 可用，Zero 2 W 偏吃力）。
3. **LLM（对话与人设）**：

   * 调用 ChatGPT/通义等 API；
   * **人设控制**：系统提示（System Prompt）+ 会话记忆（SQLite/轻量 KV）；
   * 风格模板：温柔/初恋/前任等，通过 few-shot 或提示词控制语气。
4. **TTS（文字转语音）**：

   * 云端：Azure TTS / ElevenLabs（自然度高，**可输出 viseme/phoneme 时间戳**，便于口型同步）；
   * 本地备选：eSpeak-NG（音色机械，临时应急）。
5. **口型/表情同步**：

   * **基础方案**：按音量包络（RMS/能量）驱动 3-5 帧嘴型（闭→半开→大开），实现“卡通嘴型”；
   * **进阶方案**：使用 **TTS 返回的 viseme 时间戳** 或 **Rhubarb** 从音频/文本生成 **viseme 序列**（AI、O、E、U、F/V 等 8–12 帧），与渲染时间轴对齐；
   * **表情**：根据 LLM 输出情绪标签（正向/中性/关怀…）切换预设表情/眨眼频率。

## 3.3 渲染与美术资源

* **Live2D 路线（推荐二次元）**：导出为帧动画或在 Pi 上用 Live2D Cubism SDK for Native（性能要求略高）；
* **PNG 帧序列**：最稳妥——一张底图 + 多张嘴型/表情透明叠加；
* **圆形遮罩**：GPU/像素级剪裁为正圆，黑色全屏背景（提升折射对比度）；
* **Gamma/亮度**：OLED 更佳；若 LCD，贴轻微**防眩膜**减少高光。

## 3.4 数据与隐私

* **本地缓存**：SQLite 存历史对话（可限量滚动）；
* **敏感开关**：离线模式、清空记忆；
* **内容安全**：请求前后做关键字审查（简单正则/本地模型/云审查）。

---

# 4. 生产/装配流程（MVP）

## 4.1 原型打样

1. 采购：水晶球（80–90 mm）、2.1" 圆形 HDMI 屏、树莓派、USB 麦/I2S 麦、I2S 功放+喇叭、5 V/3 A 供电、Type-C 模块、导热垫、黑色植绒纸/消光漆。
2. 3D 建模：底座与遮光罩（Fusion 360/FreeCAD），注意留线槽与散热窗。
3. 打印与试装：3D 打印底座 → 装屏 → 贴导热垫 → 装 Pi → 走线。
4. 遮光：在屏周围贴黑色植绒纸形成黑腔，只露出屏可视区。
5. 放置球体：球与屏留 0.5–1 mm 间隙，三点胶垫定位；若用光学胶请先试样防气泡。

## 4.2 软件安装与联调

1. 刷写系统，启用 SSH、音频、Wi-Fi；
2. 安装依赖：Python、pygame/SDL、pyaudio/sounddevice、edge-tts/云 TTS SDK、ASR SDK、Rhubarb（如用）；
3. 渲染测试：播放 480×480 圆形 demo（黑底、静态人物，检查亮度/偏色）；
4. 音频链路：录音→ASR→LLM→TTS→播放 验证时延；
5. 口型同步：根据 TTS 时间戳/能量包络驱动嘴型序列；
6. 开机自启：写 systemd service（异常自动重启）。

---

# 5. 校准与体验调优

* **几何校准**：微调屏-球距离与中心同轴，确保人物位于球中央；
* **亮度/对比**：尽量使用深色背景 UI；必要时提高 TTS 音量并做 AGC；
* **眩光**：顶面若有高光，给球顶部**轻磨砂点涂**或外部加柔光罩（尽量不破坏整体通透）；
* **发热**：连续播放 10 分钟测温，>60 ℃ 增加导热片或金属底圈；
* **回声啸叫**：麦克风尽量远离喇叭，开启 AEC；
* **时延**：目标端到端 1.5–2.5 s；若>3 s，改用更快的 ASR/TTS 或提前预缓冲嘴型。

---

# 6. 风险与规避

* **亮度不足**：优先 OLED 圆屏；或减小球径/加遮光罩；
* **画面变形/畸变**：尽量把关键 UI 放在画面中心 50–60% 半径内；
* **SPI 屏卡顿**：改 HDMI 圆屏或 Pi 直连 DSI 屏；
* **云端不稳**：加入离线兜底话术 + 本地 TTS/预录音；
* **结构松动**：三点弹性支撑+硅胶圈；搬运/跌落测试。

---

# 7. 物料清单（BOM，示例级）

* 水晶/亚克力球 80–90 mm（光学级透明）×1
* 圆形 HDMI 屏 2.1" 480×480（含驱动板）×1
* Raspberry Pi Zero 2 W / Pi 4 ×1（Zero 2 W 更紧凑，Pi 4 性能更强）
* USB 麦克风 或 I2S 麦阵列 ×1
* I2S D 类功放 MAX98357A ×1 + 1–2 W 迷你喇叭 ×1
* 5 V/3 A Type-C 供电 或 1S 锂电+升压+充电保护板 ×1
* 导热垫、黑色植绒纸/消光漆、硅胶脚垫、M2/M3 螺丝若干
* 3D 打印底座与遮光罩（PLA/ABS/尼龙）

---

# 8. 开发里程碑（参考）

* **第 1 周**：BOM 下单，底座建模与3D打印；屏-球机械试装；
* **第 2 周**：跑通“录音→ASR→LLM→TTS→播放”；渲染 demo；
* **第 3 周**：口型同步与情绪表情；自启动与稳定性；
* **第 4 周**：结构与散热优化、观感调优、演示脚本。

---

# 9. 你会用到的“核心技术点”清单（便于分工）

* **光学/结构**：屏-球耦合、遮光腔、导热/散热、手持重心与包络；
* **显示渲染**：480×480 圆形画布、帧序列合成、圆形遮罩与 gamma；
* **语音链路**：ASR/LLM/TTS（云端 API）、AEC/AGC、延迟优化；
* **口型/表情**：能量驱动 → viseme 驱动、情绪标签到表情映射；
* **系统工程**：systemd、异常重启、日志与远程维护；
* **合规与隐私**：本地缓存控制、内容安全开关、用户可清除记录。

---

